


<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-5.5.3">
    
    
      
        <title>MS SQL Server - Notes</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.947af8d5.min.css">
      
      
    
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
    
      
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#ms-sql-server" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href="../.." title="Notes" class="md-header-nav__button md-logo" aria-label="Notes">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            Notes
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              MS SQL Server
            
          </span>
        </div>
      
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active">
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
        
      
      
        
          

  

<nav class="md-tabs md-tabs--active" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  <li class="md-tabs__item">
    
      <a href="../.." class="md-tabs__link">
        Home
      </a>
    
  </li>

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../accessibility/accessibility/" class="md-tabs__link">
          Accessibility
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="./" class="md-tabs__link md-tabs__link--active">
          Databases
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../development/api/" class="md-tabs__link">
          Development
        </a>
      
    </li>
  

      
    </ul>
  </div>
</nav>
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Notes" class="md-nav__button md-logo" aria-label="Notes">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    Notes
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      Accessibility
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Accessibility" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        Accessibility
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../accessibility/accessibility/" title="Web Accessibility" class="md-nav__link">
      Web Accessibility
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../accessibility/design/" title="Design Choices" class="md-nav__link">
      Design Choices
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../accessibility/guidelines/" title="WCAG Guidelines" class="md-nav__link">
      WCAG Guidelines
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../accessibility/roleInSoftware/" title="Accessibility and Software Development" class="md-nav__link">
      Accessibility and Software Development
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../accessibility/tools/" title="Tools" class="md-nav__link">
      Tools
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../accessibility/wet/" title="Web Experience Toolkit (WET)" class="md-nav__link">
      Web Experience Toolkit (WET)
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3" checked>
    
    <label class="md-nav__link" for="nav-3">
      Databases
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Databases" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        Databases
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        MS SQL Server
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 9h14V7H3v2m0 4h14v-2H3v2m0 4h14v-2H3v2m16 0h2v-2h-2v2m0-10v2h2V7h-2m0 6h2v-2h-2v2z"/></svg>
        </span>
      </label>
    
    <a href="./" title="MS SQL Server" class="md-nav__link md-nav__link--active">
      MS SQL Server
    </a>
    
      
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#vulnerability-assessment" class="md-nav__link">
    Vulnerability Assessment
  </a>
  
    <nav class="md-nav" aria-label="Vulnerability Assessment">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#how-to-find-va-through-ssms" class="md-nav__link">
    How to find VA through SSMS
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#how-to-find-va-through-azure-portal-for-a-sql-server-deployed-on-a-machine" class="md-nav__link">
    How to find VA through Azure Portal for a SQL server deployed on a machine
  </a>
  
    <nav class="md-nav" aria-label="How to find VA through Azure Portal for a SQL server deployed on a machine">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#these-paths-dont-work" class="md-nav__link">
    These paths don't work:
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#assessment-rules" class="md-nav__link">
    Assessment Rules
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#va1051" class="md-nav__link">
    VA1051
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#va1219" class="md-nav__link">
    VA1219
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#va1287" class="md-nav__link">
    VA1287
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#va2109" class="md-nav__link">
    VA2109
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#va1286" class="md-nav__link">
    VA1286
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#va" class="md-nav__link">
    VA
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
    
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Development
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Development" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        Development
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../development/api/" title="API" class="md-nav__link">
      API
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../development/aspdotnet/" title="ASP.Net 4 Web Forms" class="md-nav__link">
      ASP.Net 4 Web Forms
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../development/git/" title="Git" class="md-nav__link">
      Git
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#vulnerability-assessment" class="md-nav__link">
    Vulnerability Assessment
  </a>
  
    <nav class="md-nav" aria-label="Vulnerability Assessment">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#how-to-find-va-through-ssms" class="md-nav__link">
    How to find VA through SSMS
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#how-to-find-va-through-azure-portal-for-a-sql-server-deployed-on-a-machine" class="md-nav__link">
    How to find VA through Azure Portal for a SQL server deployed on a machine
  </a>
  
    <nav class="md-nav" aria-label="How to find VA through Azure Portal for a SQL server deployed on a machine">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#these-paths-dont-work" class="md-nav__link">
    These paths don't work:
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#assessment-rules" class="md-nav__link">
    Assessment Rules
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#va1051" class="md-nav__link">
    VA1051
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#va1219" class="md-nav__link">
    VA1219
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#va1287" class="md-nav__link">
    VA1287
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#va2109" class="md-nav__link">
    VA2109
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#va1286" class="md-nav__link">
    VA1286
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#va" class="md-nav__link">
    VA
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                  
                
                
                <h1 id="ms-sql-server">MS SQL Server<a class="headerlink" href="#ms-sql-server" title="Permanent link">&para;</a></h1>
<h2 id="vulnerability-assessment">Vulnerability Assessment<a class="headerlink" href="#vulnerability-assessment" title="Permanent link">&para;</a></h2>
<h3 id="how-to-find-va-through-ssms">How to find VA through SSMS<a class="headerlink" href="#how-to-find-va-through-ssms" title="Permanent link">&para;</a></h3>
<ul>
<li>Source: <a href="https://docs.microsoft.com/en-us/sql/relational-databases/security/sql-vulnerability-assessment?view=sql-server-ver15">https://docs.microsoft.com/en-us/sql/relational-databases/security/sql-vulnerability-assessment?view=sql-server-ver15</a></li>
<li>Open Microsoft SQL Server Management Studio</li>
<li>Right click database-&gt;Tasks-&gt;Vulnerability Assessment-&gt;Scan For Vulnerabilities</li>
<li>Should open up a Vulnerability Assessment Results tab + a JSON file that's saved on the computer</li>
</ul>
<h3 id="how-to-find-va-through-azure-portal-for-a-sql-server-deployed-on-a-machine">How to find VA through Azure Portal for a SQL server deployed on a machine<a class="headerlink" href="#how-to-find-va-through-azure-portal-for-a-sql-server-deployed-on-a-machine" title="Permanent link">&para;</a></h3>
<ul>
<li>Go to 'Security Center'</li>
<li>Under 'Resource security hygiene', click on 'Recommendations'</li>
<li>Click on one of the controls that you think is for a SQL server (eg: 'Vulnerability on your SQL server machines should be mediated)<ul>
<li>Click on the specific recommendation</li>
<li>Click on one of the VAs</li>
<li>Scroll down to affected resources, click on the interested database</li>
</ul>
</li>
</ul>
<h4 id="these-paths-dont-work">These paths don't work:<a class="headerlink" href="#these-paths-dont-work" title="Permanent link">&para;</a></h4>
<ul>
<li>Go to 'Security Center'</li>
<li>Under 'Resource security hygiene', in 'Resource health by severity', there might be a 'Data Storage and Resources'</li>
<li>Once you click on it, there might be a 'SQL' tab with a list of deployed SQL servers</li>
<li>Once you click on the interested database, there should be a section called Recommendations</li>
<li>Click on the recommendations only to see a error screen that makes you question why Microsoft sucks. </li>
</ul>
<h3 id="assessment-rules">Assessment Rules<a class="headerlink" href="#assessment-rules" title="Permanent link">&para;</a></h3>
<ul>
<li>Source: <a href="https://eitanblumin.com/sql-vulnerability-assessment-tool-rules-reference-list/#Rule_VA1051">https://eitanblumin.com/sql-vulnerability-assessment-tool-rules-reference-list/#Rule_VA1051</a></li>
<li>Source: <a href="https://docs.microsoft.com/en-us/azure/azure-sql/database/sql-database-vulnerability-assessment-rules">https://docs.microsoft.com/en-us/azure/azure-sql/database/sql-database-vulnerability-assessment-rules</a></li>
<li>Auditing And Logging – 3 rule(s)<ul>
<li>Severity: Medium – 2 rule(s)<ul>
<li>VA1265: Auditing of both successful and failed login attempts for contained DB authentication should be enabled</li>
<li>VA1281: All memberships for user-defined roles should be intended</li>
</ul>
</li>
<li>Severity: Low – 1 rule(s)<ul>
<li>VA1253: List of DB-scoped events being audited and centrally managed via server audit specifications.</li>
</ul>
</li>
</ul>
</li>
<li>Authentication And Authorization – 36 rule(s)<ul>
<li>Severity: High – 8 rule(s)<ul>
<li>VA1020: Server principal GUEST should not be a member of any role</li>
<li>VA2000: Minimal set of principals should be granted high impact database-scoped permissions</li>
<li>VA2001: Minimal set of principals should be granted high impact database-scoped permissions on objects or columns</li>
<li>VA2002: Minimal set of principals should be granted high impact database-scoped permissions on various securables</li>
<li>VA2020: Minimal set of principals should be granted ALTER or ALTER ANY USER database-scoped permissions</li>
<li>VA2021: Minimal set of principals should be granted database-scoped ALTER permissions on objects or columns</li>
<li>VA2022: Minimal set of principals should be granted database-scoped ALTER permission on various securables</li>
<li>VA2108: Minimal set of principals should be members of fixed high impact database roles</li>
</ul>
</li>
<li>Severity: Medium – 9 rule(s)<ul>
<li>VA1042: Database ownership chaining should be disabled for all databases except for ‘master’ and ‘tempdb’</li>
<li>VA1043: Principal GUEST should not have access to any user database</li>
<li>VA1095: Excessive permissions should not be granted to PUBLIC role</li>
<li>VA1248: User-defined database roles should not be members of fixed roles</li>
<li>VA1267: Contained users should use Windows Authentication</li>
<li>VA2010: Minimal set of principals should be granted medium impact database-scoped permissions</li>
<li>VA2050: Minimal set of principals should be granted database-scoped VIEW DEFINITION permissions</li>
<li>VA2051: Minimal set of principals should be granted database-scoped VIEW DEFINITION permissions on schema</li>
<li>VA2052: Minimal set of principals should be granted database-scoped VIEW DEFINITION permission on various securables</li>
</ul>
</li>
<li>Severity: Low – 19 rule(s)<ul>
<li>VA1054: Excessive permissions should not be granted to PUBLIC role on objects or columns</li>
<li>VA1069: Permissions to select from system tables and views should be revoked from non-sysadmins</li>
<li>VA1070: Database users shouldn’t share the same name as a server login.</li>
<li>VA1094: Database permissions shouldn’t be granted directly to principals</li>
<li>VA1096: Principal GUEST should not be granted permissions in the database</li>
<li>VA1097: Principal GUEST should not be granted permissions on objects or columns</li>
<li>VA1099: GUEST user should not be granted permissions on database securables</li>
<li>VA1246: Application roles should not be used</li>
<li>VA1282: Orphan roles should be removed</li>
<li>VA1286: Database permissions shouldn’t be granted directly to principals (OBJECT or COLUMN)</li>
<li>VA2030: Minimal set of principals should be granted database-scoped SELECT or EXECUTE permissions</li>
<li>VA2031: Minimal set of principals should be granted database-scoped SELECT permission on objects or columns</li>
<li>VA2032: Minimal set of principals should be granted database-scoped SELECT or EXECUTE permissions on schema</li>
<li>VA2033: Minimal set of principals should be granted database-scoped EXECUTE permission on objects or columns</li>
<li>VA2034: Minimal set of principals should be granted database-scoped EXECUTE permission on XML Schema Collection</li>
<li>VA2040: Minimal set of principals should be granted low impact database-scoped permissions</li>
<li>VA2041: Minimal set of principals should be granted low impact database-scoped permissions on objects or columns</li>
<li>VA2042: Minimal set of principals should be granted low impact database-scoped permissions on schema</li>
<li>VA2109: Minimal set of principals should be members of fixed low impact database roles</li>
</ul>
</li>
</ul>
</li>
<li>Data Protection – 7 rule(s)<ul>
<li>Severity: High – 5 rule(s)<ul>
<li>VA1098: Any Existing SSB or Mirroring endpoint should require AES connection</li>
<li>VA1221: Database Encryption Symmetric Keys should use AES algorithm</li>
<li>VA1222: Cell-Level Encryption keys should use AES algorithm</li>
<li>VA1223: Certificate keys should use at least 2048 bits</li>
<li>VA1224: Asymmetric keys’ length should be at least 2048 bits</li>
</ul>
</li>
<li>Severity: Medium – 2 rule(s)<ul>
<li>VA1219: Transparent data encryption should be enabled</li>
<li>VA1287: Sensitive data columns should be classified</li>
<li>Surface Area Reduction – 8 rule(s)</li>
</ul>
</li>
<li>Severity: High – 4 rule(s)<ul>
<li>VA1102: The Trustworthy bit should be disabled on all databases except MSDB</li>
<li>VA1245: The dbo information should be consistent between the target DB and master</li>
<li>VA1256: User CLR assemblies should not be defined in the database</li>
<li>VA1277: Polybase network encryption should be enabled</li>
</ul>
</li>
<li>Severity: Medium – 4 rule(s)<ul>
<li>VA1044: Remote Admin Connections should be disabled</li>
<li>VA1051: AUTO_CLOSE should be disabled on all databases</li>
<li>VA1143: ‘dbo’ user should not be used for normal service operation</li>
<li>VA1244: Orphaned users should be removed from SQL server databases</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="va1051">VA1051<a class="headerlink" href="#va1051" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>Name:</strong> VA1051: AUTO_CLOSE should be disabled on all databases</li>
<li><strong>Summary and "why care" for dummies:</strong> SQL Servers might have a ton of databases.If AUTO_CLOSE is true for all of them, they'll go "offline" when a app is not using them. Let's say your app needs to authenticate a user so it'll need the database to re-start, set everything up and then eventually shut down. If this happens for a lot of users for a lot of databases on the same server, the server will get overwhelmed with the requests and just crash. </li>
<li><strong>Risk Level:</strong> Medium</li>
<li><strong>Benchmark:</strong> CIS v1.0.0-08-11-2017:2.16, FedRAMP</li>
<li><strong>Description:</strong> The AUTO_CLOSE option specifies whether the database shuts down cleanly and frees resources after the last user exits. This rule checks that this option is disabled on all databases.</li>
<li><strong>Impact:</strong> Databases marked with AUTO_CLOSE allows the DB to be closed if there are no active connections. In the case of particularly contained databases, the authentication of users occurs within teh database itself, so the database must be opened every time to authenticate a user. Frequent opening/closing of the database consumes additional resources and may contribute to denial of service attack. </li>
<li><strong>How to check if you db is affected:</strong> <ul>
<li>In SSMS, Right click Database-&gt;Properties</li>
<li>Options page and then under Automatic, if Auto Close is 'True', then it's enabled. </li>
</ul>
</li>
<li><strong>Bulk query to find all problem databases:</strong></li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="k">SELECT</span> <span class="k">CASE</span>
    <span class="k">WHEN</span> <span class="k">EXISTS</span> <span class="p">(</span>
        <span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">sys</span><span class="p">.</span><span class="n">databases</span>
        <span class="k">WHERE</span> <span class="n">NAME</span> <span class="o">=</span> <span class="n">DB_NAME</span><span class="p">()</span>
            <span class="k">AND</span> <span class="n">is_auto_close_on</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="k">THEN</span> <span class="mi">1</span>
        <span class="k">ELSE</span> <span class="mi">0</span>
        <span class="k">END</span> <span class="k">AS</span> <span class="n">VIOLATION</span><span class="p">,</span> <span class="n">DB_name</span><span class="p">()</span> <span class="k">AS</span> <span class="p">[</span><span class="k">DATABASE</span><span class="p">]</span>
    <span class="p">)</span>
</code></pre></div>


<ul>
<li><strong>Remediation Steps/Script:</strong><ul>
<li>Change Auto Close in Options to 'False'</li>
<li>Remediation Script: </li>
</ul>
</li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="k">ALTER</span> <span class="k">DATABASE</span> <span class="p">[</span><span class="n">yourDatabaseName</span><span class="p">]</span> <span class="k">SET</span> <span class="n">AUTO_CLOSE</span> <span class="k">OFF</span>
</code></pre></div>


<h3 id="va1219">VA1219<a class="headerlink" href="#va1219" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>Name:</strong> VA1219: Transparent data encryption should be enabled</li>
<li><strong>Summary and "why care" for dummies:</strong> If TDE isn't being done, any backups, etc are encrypted when stored on the computer. So if a malicious person gets access to your computer, they won't be able to decrypt the backups/logs, etc without a key. </li>
<li><strong>Risk Level:</strong> Medium</li>
<li><strong>Description:</strong> Transparent data encryption (TDE) helps protect against the threat of malicious activity by performing real-time encryption and decryption of the database, associated backups, and transaction log files ‘at rest’, without requiring changes to the application. This rule checks that TDE is enabled on the database.</li>
<li><strong>Impact:</strong> Transparent Data Encryption (TDE) protects data ‘at rest’, meaning the data and log files are encrypted when stored on disk.    </li>
<li><strong>Bulk query to find all problem databases:</strong></li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="k">CASE</span><span class="w"> </span><span class="k">WHEN</span><span class="w"> </span><span class="ow">EXISTS</span><span class="w"></span>
<span class="p">(</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"></span>
<span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">sys</span><span class="p">.</span><span class="n">databases</span><span class="w"></span>
<span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">db_name</span><span class="p">()</span><span class="w"></span>
<span class="w">    </span><span class="ow">AND</span><span class="w"> </span><span class="n">is_encrypted</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="k">THEN</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="k">ELSE</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="k">END</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="o">[</span><span class="n">Violation</span><span class="o">]</span><span class="w"></span>
</code></pre></div>


<ul>
<li><strong>Remediation Steps/Script:</strong></li>
<li>Unmanaged SQL servers: <ul>
<li>Enable TDE on the affected database. Please follow the instructions on <a href="https://docs.microsoft.com/en-us/sql/relational-databases/security/encryption/transparent-data-encryption">https://docs.microsoft.com/en-us/sql/relational-databases/security/encryption/transparent-data-encryption</a></li>
</ul>
</li>
<li>Azure SQL VM: <ul>
<li>Security section is disabled. So....I don't know</li>
</ul>
</li>
<li>Azure Managed Database: <ul>
<li>Login to Portal</li>
<li>Search for 'Azure SQL' or 'SQL databases' or whatever Azure calls it that day</li>
<li>Choose the interested database</li>
<li>On left, click on Security</li>
<li>Click on 'Transparent data encryption'</li>
<li>Set Data encryption to ON</li>
<li>Click on Save</li>
</ul>
</li>
</ul>
<h3 id="va1287">VA1287<a class="headerlink" href="#va1287" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>Name:</strong> VA1287: Sensitive data columns should be classified  </li>
<li><strong>Summary and "why care" for dummies:</strong> Some columns might have sensitive data that you want to run reports on later. Therefore, if they have metadata that flags these columns, it's easier to run these reports in case you care. </li>
<li><strong>Risk Level:</strong> </li>
<li><strong>Description:</strong> This rule discovers and characterizes potentially sensitive data in the database. The result is a collection of sensitive database columns, which should be reviewed and classified using SQL Data Discovery &amp; Classification. This allows database columns to be persistently labeled according to their sensitivity, which enables tracking (auditing) the use of classified data and creating reports. If your sensitive database columns are unprotected, you should also consider applying one of SQL Database’s built-in security capabilities to restrict access to and protect your sensitive data.</li>
<li><strong>Impact:</strong> The data residing in your database can have varying levels of business and privacy sensitivity. It is important to be aware of the location of your most sensitive data elements, so that their access can be monitored and tracked. SQL Data Discovery &amp; Classification enables you to assign a distinct classification label to each database column and persist this information as column metadata within the database. This classification metadata can then be used for tracking and monitoring objectives. In addition, access to sensitive data should be more tightly controlled. Built-in SQL security capabilities like Always Encrypted, Dynamic Data Masking, and Row-Level Security can be used to control access and protect data.</li>
<li><strong>How to check if you db is affected:</strong><ul>
<li>Run the VA. If your columns have emails, dates, etc, it'll probably get flagged</li>
</ul>
</li>
<li><strong>Find all problem databases:</strong> Review the identified list of potentially sensitive columns and apply classifications where relevant via the Classify Data task of the database. If none of the identified columns actually represent sensitive elements in your database, you can set them as your approved baseline to acknowledge their status and to prevent them from being identified again. In addition, apply column-level data protection security measures where appropriate: Always Encrypted — keeps sensitive data columns encrypted on the server side (‘<a href="https://go.microsoft.com/fwlink/?linkid=862688&amp;#8217">https://go.microsoft.com/fwlink/?linkid=862688&amp;#8217</a>;) or Dynamic Data Masking — limits sensitive data exposure by dynamically masking it to non-privileged users when data is returned from the server to the client (‘<a href="https://go.microsoft.com/fwlink/?linkid=524331&amp;#8217">https://go.microsoft.com/fwlink/?linkid=524331&amp;#8217</a>;). You can also use Row Level Security to restrict access to data rows by creating a security policy based on characteristics of the user executing a query (‘<a href="https://go.microsoft.com/fwlink/?linkid=862687&#8217;">https://go.microsoft.com/fwlink/?linkid=862687&#8217;</a>).</li>
<li><strong>Remediation Steps/Script:</strong><ul>
<li>Run VA on your specific database to get remediation script but review each one!<ul>
<li>It's stupid enough to think a date is for a Credit card and that an PK id is Financial info or National ID. </li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="c1">--Todo - add what kind of scripts might be generated in terms of what labels you can add yourself</span>
</code></pre></div>


<h3 id="va2109">VA2109<a class="headerlink" href="#va2109" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>Name:</strong>  </li>
<li><strong>Summary and "why care" for dummies:</strong></li>
<li><strong>Risk Level:</strong> </li>
<li><strong>Description:</strong> </li>
<li><strong>Impact:</strong></li>
<li><strong>How to check if you db is affected:</strong></li>
<li><strong>Bulk query to find all problem databases:</strong></li>
</ul>
<div class="codehilite"><pre><span></span><code>
</code></pre></div>


<ul>
<li><strong>Remediation Steps/Script:</strong></li>
</ul>
<div class="codehilite"><pre><span></span><code>
</code></pre></div>


<h3 id="va1286">VA1286<a class="headerlink" href="#va1286" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>Name:</strong>  </li>
<li><strong>Summary and "why care" for dummies:</strong></li>
<li><strong>Risk Level:</strong> </li>
<li><strong>Description:</strong> </li>
<li><strong>Impact:</strong></li>
<li><strong>How to check if you db is affected:</strong></li>
<li><strong>Bulk query to find all problem databases:</strong></li>
</ul>
<div class="codehilite"><pre><span></span><code>
</code></pre></div>


<ul>
<li><strong>Remediation Steps/Script:</strong></li>
</ul>
<div class="codehilite"><pre><span></span><code>
</code></pre></div>


<h3 id="va">VA<a class="headerlink" href="#va" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>Name:</strong>  </li>
<li><strong>Summary and "why care" for dummies:</strong></li>
<li><strong>Risk Level:</strong> </li>
<li><strong>Description:</strong> </li>
<li><strong>Impact:</strong></li>
<li><strong>How to check if you db is affected:</strong></li>
<li><strong>Bulk query to find all problem databases:</strong></li>
</ul>
<div class="codehilite"><pre><span></span><code>
</code></pre></div>


<ul>
<li><strong>Remediation Steps/Script:</strong></li>
</ul>
<div class="codehilite"><pre><span></span><code>
</code></pre></div>
                
                  
                    

<hr>
<div class="md-source-date">
  <small>
    
      Last update: <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">July 17, 2020</span>
    
  </small>
</div>
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid" aria-label="Footer">
        
          <a href="../../accessibility/wet/" title="Web Experience Toolkit (WET)" class="md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
            </div>
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Web Experience Toolkit (WET)
              </div>
            </div>
          </a>
        
        
          <a href="../../development/api/" title="API" class="md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                API
              </div>
            </div>
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/vendor.c3dc8c49.min.js"></script>
      <script src="../../assets/javascripts/bundle.f9edbbd5.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents"}</script>
      
      <script>
        app = initialize({
          base: "../..",
          features: ["tabs", "instant"],
          search: Object.assign({
            worker: "../../assets/javascripts/worker/search.8e2cddea.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
    
  </body>
</html>